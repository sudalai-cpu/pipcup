<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Pipcup{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'zone/style.css' %}?v=3">
</head>

<body>

    <header>
        <nav>
            <div class="brand">

                Pipcup <small style="font-size: 10px; color: #ffeb3b;">(Updated)</small>
            </div>

        </nav>
    </header>

    <main>
        {% block content %}
        {% endblock %}
    </main>

    <footer>
        <div class="nav-links footer-nav">
            <a href="{% url 'home' %}" class="nav-item"><i class="fas fa-home"></i></a>
            <a href="{% url 'sale' %}" class="nav-item"><i class="fas fa-tags"></i></a>
            <a href="#" class="nav-item"><i class="fas fa-comments"></i></a>
            <a href="{% url 'profile' %}" class="nav-item no-ajax"><i class="fas fa-user"></i></a>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const footerLinks = document.querySelectorAll('.footer-nav a');

            footerLinks.forEach(link => {
                link.addEventListener('click', async (e) => {
                    // Only intercept internal links
                    const href = link.getAttribute('href');
                    if (!href.startsWith('#') && !href.startsWith('http') && !link.classList.contains('no-ajax')) {
                        e.preventDefault();

                        try {
                            const response = await fetch(href);
                            if (response.ok) {
                                const text = await response.text();
                                const parser = new DOMParser();
                                const doc = parser.parseFromString(text, 'text/html');
                                const newMain = doc.querySelector('main');

                                if (newMain) {
                                    document.querySelector('main').innerHTML = newMain.innerHTML;
                                    window.history.pushState({}, '', href);
                                }
                            }
                        } catch (error) {
                            console.error('Navigation error:', error);
                            // Fallback to normal navigation
                            window.location.href = href;
                        }
                    }
                });
            });

            // Handle browser back/forward buttons
            window.addEventListener('popstate', async () => {
                const response = await fetch(window.location.href);
                if (response.ok) {
                    const text = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'text/html');
                    const newMain = doc.querySelector('main');
                    if (newMain) {
                        document.querySelector('main').innerHTML = newMain.innerHTML;
                    }
                }
            });
        });
    </script>
</body>

</html>